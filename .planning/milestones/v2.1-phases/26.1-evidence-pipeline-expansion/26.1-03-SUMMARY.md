---
phase: 26.1-evidence-pipeline-expansion
plan: 03
subsystem: evidence-pipeline
tags: [linkedin, scrapling, enrichment, research-executor]

# Dependency graph
requires:
  - phase: 26.1-01
    provides: LINKEDIN EvidenceSourceType enum value in DB + Prisma client
  - phase: 25-04
    provides: Scrapling service with StealthyFetcher at /fetch endpoint
provides:
  - fetchLinkedInPosts — Scrapling StealthyFetcher scrape of public company posts
  - LinkedIn posts wired into pipeline replacing Crawl4AI LinkedIn extraction
  - Empty-result placeholder recording when LinkedIn posts are blocked
  - Evidence cap raised to 48
affects: [research-executor, evidence-pipeline, quality-gate]

# Tech tracking
tech-stack:
  added: []
  patterns:
    - fetchStealth pattern: reuse scrapling.ts StealthyFetcher for post scraping
    - Empty-result recording: always push a placeholder with notFound=true when scrape returns 0 results
    - Authwall detection: html length check + phrase matching (shared pattern across LinkedIn scrapers)

key-files:
  created:
    - lib/enrichment/linkedin-posts.ts
  modified:
    - lib/research-executor.ts

key-decisions:
  - 'Replaced Crawl4AI LinkedIn extraction with Scrapling StealthyFetcher — better stealth posture for LinkedIn'
  - 'Empty-result placeholder recorded with confidenceScore 0.1 and notFound=true to distinguish blocked from not-tried'
  - 'Evidence cap raised from 36 to 48 to accommodate LinkedIn posts (up to 8 new items per pipeline run)'
  - 'Removed now-unused extractMarkdown import from crawl4ai — cleanup via Rule 1 auto-fix'

patterns-established:
  - 'linkedin-posts.ts follows same module structure as other enrichment modules (fetchStealth, EvidenceDraft[], try/catch)'

requirements-completed: [EXP-05]

# Metrics
duration: 6min
completed: 2026-02-28
---

# Phase 26.1 Plan 03: LinkedIn Company Posts via Scrapling Summary

**Scrapling StealthyFetcher LinkedIn posts module added, replacing Crawl4AI LinkedIn extraction with post-level scraping, authwall detection, and empty-result placeholder recording**

## Performance

- **Duration:** 6 min
- **Started:** 2026-02-28T04:01:28Z
- **Completed:** 2026-02-28T04:07:00Z
- **Tasks:** 2
- **Files modified:** 2

## Accomplishments

- Created `lib/enrichment/linkedin-posts.ts` with `fetchLinkedInPosts` export
- Scraples `/posts/` path using Scrapling StealthyFetcher — better LinkedIn stealth than Crawl4AI
- Authwall detection: html length check + phrase list (`authwall`, `log in to linkedin`, etc.)
- Post extraction: strips script/style, extracts `<span>` blocks, filters UI chrome, deduplicates
- Returns up to 8 post snippets as EvidenceDraft with sourceType LINKEDIN, confidence 0.73
- Full try/catch — LinkedIn blocking returns [] and never halts pipeline
- Replaced Crawl4AI LinkedIn block in research-executor.ts with `fetchLinkedInPosts`
- Empty-result placeholder recorded (confidenceScore 0.1, notFound: true) when posts return 0
- Added `linkedin_posts` to SourceDiagnostic union
- Added `linkedin_posts` skipped diagnostic in deepCrawl=false branch
- Raised evidence cap from 36 to 48

## Task Commits

Each task was committed atomically:

1. **Task 1: LinkedIn posts module via Scrapling** - `996d2df` (feat)
2. **Task 2: Wire LinkedIn posts into research-executor + empty-result recording** - `f1231dd` (feat)

**Plan metadata:** committed with final docs commit

## Files Created/Modified

- `lib/enrichment/linkedin-posts.ts` - fetchLinkedInPosts: Scrapling StealthyFetcher scrape of public company posts
- `lib/research-executor.ts` - LinkedIn posts wired into pipeline; Crawl4AI LinkedIn replaced; cap raised to 48

## Decisions Made

- StealthyFetcher over Crawl4AI for LinkedIn posts — better stealth and no dependency on Crawl4AI service availability
- confidenceScore 0.73 for successful posts (same as Apollo-derived LinkedIn evidence)
- confidenceScore 0.1 for notFound placeholder — marks the attempt, penalizes if deduplication needed
- Evidence cap 48 — LinkedIn adds up to 8 items, previous max was 36; Plan 02 will also benefit

## Deviations from Plan

### Auto-fixed Issues

**1. [Rule 1 - Bug] Removed unused extractMarkdown import**

- **Found during:** Task 2 TypeScript check
- **Issue:** `extractMarkdown` was imported from crawl4ai but no longer used after replacing the Crawl4AI LinkedIn block — TypeScript TS6133 error
- **Fix:** Removed `extractMarkdown` from crawl4ai import (kept `ingestCrawl4aiEvidenceDrafts` which is still used for SERP URLs)
- **Files modified:** lib/research-executor.ts
- **Verification:** `npx tsc --noEmit` clean after fix
- **Committed in:** f1231dd (Task 2 commit)

---

**Total deviations:** 1 auto-fixed (unused import cleanup)
**Impact on plan:** Zero scope change — import removal required for clean TypeScript build.

## Self-Check

### Created files:

- [x] lib/enrichment/linkedin-posts.ts - FOUND
- [x] .planning/phases/26.1-evidence-pipeline-expansion/26.1-03-SUMMARY.md - FOUND (this file)

### Verified artifacts:

- [x] fetchLinkedInPosts exported from linkedin-posts.ts (line 72+)
- [x] fetchLinkedInPosts imported in research-executor.ts (line 17)
- [x] fetchLinkedInPosts called in deepCrawl block (line 483)
- [x] sourceType: 'LINKEDIN' in both Apollo-derived (line 463) and LinkedIn posts (line 491)
- [x] notFound: true placeholder for empty posts (line 498)
- [x] extractMarkdown import removed (clean TypeScript)
- [x] 0 TypeScript errors (npx tsc --noEmit clean)
- [x] 0 lint errors (26 pre-existing warnings only)
- [x] Evidence cap set to 48 (line 527 after linter reformatting)

## Self-Check: PASSED

## Next Phase Readiness

- LinkedIn posts evidence available for next pipeline runs (deepCrawl=true, prospect has linkedinUrl)
- Plan 02 can run independently — it modifies different sections of research-executor.ts (Google Reviews/News blocks)
- Plan 02 will also benefit from the evidence cap increase to 48
- Quality gate (evaluatePainConfirmation) already counts LINKEDIN toward context score (Plan 01)

---

_Phase: 26.1-evidence-pipeline-expansion_
_Completed: 2026-02-28_
