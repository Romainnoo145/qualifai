---
phase: 18-research-quality-gate
plan: 03
type: execute
wave: 2
depends_on: ['18-01']
files_modified:
  - components/features/prospects/analysis-section.tsx
  - components/features/prospects/command-center.tsx
  - app/admin/prospects/[id]/page.tsx
  - app/voor/[slug]/page.tsx
autonomous: true

must_haves:
  truths:
    - 'Hypothesis approve/reject/reset buttons are gone from the admin Analysis section'
    - 'Hypothesis approve/reject buttons are gone from the command-center'
    - 'Each hypothesis in the Analysis section shows a read-only status badge (Pending validation, Confirmed, Declined)'
    - 'The /voor/ dashboard shows hypotheses with status ACCEPTED or PENDING (backward compatible)'
    - 'The setHypothesisStatus mutation and its wiring are removed from the prospect detail page'
  artifacts:
    - path: 'components/features/prospects/analysis-section.tsx'
      provides: 'Read-only hypothesis status badges replacing accept/reject buttons'
      contains: 'STATUS_LABELS'
    - path: 'components/features/prospects/command-center.tsx'
      provides: 'Hypothesis section without accept/reject buttons'
    - path: 'app/voor/[slug]/page.tsx'
      provides: 'Hypothesis filter including PENDING status'
      contains: 'PENDING'
  key_links:
    - from: 'app/voor/[slug]/page.tsx'
      to: 'prisma.prospect.findUnique'
      via: 'workflowHypotheses where filter'
      pattern: 'status.*in.*ACCEPTED.*PENDING'
    - from: 'app/admin/prospects/[id]/page.tsx'
      to: 'components/features/prospects/analysis-section.tsx'
      via: 'AnalysisSection without onSetStatus prop'
      pattern: 'AnalysisSection.*prospectId'
---

<objective>
Remove hypothesis approve/reject/reset buttons from AnalysisSection and command-center, replace with read-only status badges, remove the setHypothesisStatus mutation wiring from the prospect detail page, and update the /voor/ dashboard filter to include PENDING hypotheses.

Purpose: HYPO-05 — Admin reviews research quality (Phase 18 Plan 02), not hypothesis content. Prospects will validate hypotheses themselves on /voor/ (Phase 19). This plan removes the admin hypothesis approval UI and prepares the /voor/ filter for the new PENDING status.
Output: Clean read-only hypothesis display in admin, /voor/ dashboard backward-compatible with both ACCEPTED and PENDING hypotheses.
</objective>

<execution_context>
@/home/klarifai/.claude/get-shit-done/workflows/execute-plan.md
@/home/klarifai/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/STATE.md
@.planning/phases/18-research-quality-gate/18-RESEARCH.md
@.planning/phases/18-research-quality-gate/18-01-SUMMARY.md
@components/features/prospects/analysis-section.tsx
@components/features/prospects/command-center.tsx
@app/admin/prospects/[id]/page.tsx
@app/voor/[slug]/page.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Remove accept/reject buttons from AnalysisSection, replace with read-only status badges</name>
  <files>components/features/prospects/analysis-section.tsx, app/admin/prospects/[id]/page.tsx</files>
  <action>
1. **components/features/prospects/analysis-section.tsx:**

a. Update the `Finding` type's `status` field to include the new enum values:

```typescript
status: 'DRAFT' | 'ACCEPTED' | 'REJECTED' | 'PENDING' | 'DECLINED';
```

b. Add a `STATUS_LABELS` map for read-only display (replacing internal enum names with user-friendly labels):

```typescript
const STATUS_LABELS: Record<string, string> = {
  DRAFT: 'Pending validation',
  ACCEPTED: 'Pending validation', // Legacy admin-accepted, same display as PENDING
  PENDING: 'Pending validation',
  REJECTED: 'Skipped', // Legacy admin-rejected
  DECLINED: 'Declined by prospect',
};
```

c. Update `STATUS_PILL` to include the new statuses:

```typescript
const STATUS_PILL: Record<string, string> = {
  ACCEPTED: 'bg-blue-50 text-blue-700 border-blue-200', // Changed from emerald — no longer means "admin approved"
  REJECTED: 'bg-slate-100 text-slate-500 border-slate-200', // Dimmed — legacy
  DRAFT: 'bg-blue-50 text-blue-700 border-blue-200', // Same as PENDING
  PENDING: 'bg-blue-50 text-blue-700 border-blue-200',
  DECLINED: 'bg-red-50 text-red-600 border-red-200',
};
```

d. In `FindingCard`, **remove** the entire `<div className="flex items-center gap-1.5 shrink-0">` block (lines 83-108) that contains the Accept/Reject/Reset buttons.

e. Replace the removed buttons block with a simple read-only badge:

```tsx
<span
  className={`text-[10px] font-medium px-2 py-0.5 rounded-full border shrink-0 ${STATUS_PILL[finding.status] ?? STATUS_PILL.DRAFT}`}
>
  {STATUS_LABELS[finding.status] ?? 'Pending validation'}
</span>
```

This is a passive badge, not a button — no onClick.

f. Remove the `onSetStatus` prop from `FindingCard`:

- Remove `onSetStatus: SetStatus` from the destructured props
- Remove the `const set = ...` line
- Remove the `SetStatus` type alias (no longer used)
- Remove the `BTN` constant (no longer used)

g. Update `AnalysisSection` props:

- Remove `onSetStatus: SetStatus` from the component props interface
- Remove it from the destructured props
- Remove `onSetStatus={onSetStatus}` from the `FindingCard` invocation

h. Update the summary line (around line 279) — remove the "accepted" count since admin no longer accepts:

```tsx
<p className="text-[10px] font-black text-slate-300 uppercase tracking-[0.2em]">
  Analysis ({findings.length} finding{findings.length !== 1 ? 's' : ''})
</p>
```

i. Update `ORDER` sort map to handle new statuses:

```typescript
const ORDER: Record<string, number> = {
  PENDING: 0,
  ACCEPTED: 0,
  DRAFT: 1,
  DECLINED: 2,
  REJECTED: 3,
};
```

2. **app/admin/prospects/[id]/page.tsx:**

   a. Remove the `setHypothesisStatus` mutation hook (line 47-50):

   ```typescript
   // DELETE these lines:
   const setHypothesisStatus = api.hypotheses.setStatus.useMutation({
     onSuccess: () =>
       utils.hypotheses.listByProspect.invalidate({ prospectId: id }),
   });
   ```

   b. Update the `AnalysisSection` invocation (around line 252-257). Remove the `onSetStatus` prop:

   ```tsx
   {
     /* Before: */
   }
   <AnalysisSection
     prospectId={id}
     onSetStatus={(kind, entryId, status) =>
       setHypothesisStatus.mutate({ kind, id: entryId, status })
     }
   />;

   {
     /* After: */
   }
   <AnalysisSection prospectId={id} />;
   ```

   c. If `utils` is no longer used for anything else, check if it's still needed. It IS still used by `ContactsSection` (`onContactCreated={() => utils.admin.getProspect.invalidate({ id })}`), so keep it.

   d. Remove the `api.hypotheses.setStatus` import if it was explicitly imported (it's not — it's accessed via `api` which is already imported).
   </action>
   <verify>

- `npm run check` passes
- `grep -n 'onSetStatus\|Accept\|Reject\|Reset' components/features/prospects/analysis-section.tsx` returns NO matches for button labels
- `grep -n 'STATUS_LABELS' components/features/prospects/analysis-section.tsx` shows the label map
- `grep -n 'setHypothesisStatus' app/admin/prospects/[id]/page.tsx` returns NO matches
- `grep -n 'AnalysisSection' app/admin/prospects/[id]/page.tsx` shows it without onSetStatus prop
  </verify>
  <done>AnalysisSection shows read-only status badges instead of accept/reject/reset buttons. Prospect detail page no longer wires setHypothesisStatus mutation. All hypothesis statuses (DRAFT, ACCEPTED, PENDING, REJECTED, DECLINED) display with appropriate labels and colors.</done>
  </task>

<task type="auto">
  <name>Task 2: Remove accept/reject from command-center and update /voor/ filter to include PENDING</name>
  <files>components/features/prospects/command-center.tsx, app/voor/[slug]/page.tsx</files>
  <action>
1. **components/features/prospects/command-center.tsx** (lines 224-244):

The hypotheses section has inline Accept/Reject buttons. Replace them with read-only status badges.

a. Find the hypothesis list rendering section (around line 210-248). The buttons are in a `<div className="flex items-center gap-2 shrink-0">` block per hypothesis.

b. Replace the Accept/Reject button block with a read-only badge matching the AnalysisSection pattern:

```tsx
<span className="text-[10px] font-medium px-2 py-0.5 rounded-full border bg-blue-50 text-blue-700 border-blue-200 shrink-0">
  {h.status === 'DECLINED' ? 'Declined' : 'Pending validation'}
</span>
```

c. Remove the `onSetHypothesisStatus` prop if it becomes unused. Check the component's props interface — if `onSetHypothesisStatus` is only used for these buttons, remove it from the props type, the destructured props, and any parent component passing it. If it's also used elsewhere in the component, keep it.

d. Check the parent component that renders `CommandCenter` — if it passes `onSetHypothesisStatus`, remove that prop-passing. The parent is likely `app/admin/prospects/[id]/page.tsx` but CommandCenter may not be rendered from there (Phase 13 moved content to sections). If no parent passes it, it may be unused already. Verify with grep.

2. **app/voor/[slug]/page.tsx** (line 47):

   Change the hypothesis filter from:

   ```typescript
   where: { status: 'ACCEPTED' },
   ```

   to:

   ```typescript
   where: { status: { in: ['ACCEPTED', 'PENDING'] } },
   ```

   Also update the comment on line 45 from:

   ```typescript
   // Evidence-backed content from ACCEPTED hypotheses
   ```

   to:

   ```typescript
   // Evidence-backed content from quality-approved hypotheses
   ```

   This ensures:
   - Existing prospects with ACCEPTED hypotheses (pre-Phase 18) continue to show on /voor/
   - New prospects whose research was quality-approved (PENDING status) also show on /voor/
   - No data migration needed — both statuses are valid display states
     </action>
     <verify>

- `npm run check` passes
- `grep -n 'Accept\|Reject' components/features/prospects/command-center.tsx` returns NO matches for button labels (may still have status strings — that's fine)
- `grep -n "in.*ACCEPTED.*PENDING" app/voor/[slug]/page.tsx` confirms the updated filter
- `grep -rn 'onSetHypothesisStatus' components/features/prospects/` shows no remaining usage (or shows it only where still needed)
  </verify>
  <done>Command-center shows read-only status badges for hypotheses. /voor/ dashboard displays both ACCEPTED and PENDING hypotheses. No hypothesis approve/reject buttons remain in admin UI.</done>
  </task>

</tasks>

<verification>
1. `npm run check` — full TypeScript + lint + format passes
2. No Accept/Reject/Reset buttons in analysis-section.tsx or command-center.tsx
3. Each hypothesis shows a read-only status badge with user-friendly label
4. /voor/[slug] page queries hypotheses with `{ status: { in: ['ACCEPTED', 'PENDING'] } }`
5. setHypothesisStatus mutation is no longer wired in prospect detail page
6. Existing prospects with ACCEPTED hypotheses still display correctly on /voor/
</verification>

<success_criteria>

- All hypothesis approve/reject buttons removed from admin UI (HYPO-05 complete)
- Read-only status badges show appropriate labels for all hypothesis statuses
- /voor/ dashboard is backward-compatible with both ACCEPTED and PENDING hypotheses
- No TypeScript errors, no dead prop warnings
  </success_criteria>

<output>
After completion, create `.planning/phases/18-research-quality-gate/18-03-SUMMARY.md`
</output>
