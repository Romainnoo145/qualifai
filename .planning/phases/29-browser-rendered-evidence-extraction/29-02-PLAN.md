---
phase: 29-browser-rendered-evidence-extraction
plan: 02
type: execute
wave: 2
depends_on: [29-01]
files_modified:
  - lib/research-executor.ts
autonomous: true
requirements: [EXTR-01, EXTR-02, EXTR-03]

must_haves:
  truths:
    - 'Research executor passes jsHeavyHints map from sourceSet to ingestWebsiteEvidenceDrafts'
    - 'jsHeavyHint values from Phase 28 sourceSet.urls flow through to extraction routing decisions'
    - 'Existing callers without sourceSet still work (backwards-compatible)'
  artifacts:
    - path: 'lib/research-executor.ts'
      provides: 'jsHeavyHints map construction and passing'
      contains: 'jsHeavyHints'
  key_links:
    - from: 'lib/research-executor.ts'
      to: 'lib/web-evidence-adapter.ts'
      via: 'ingestWebsiteEvidenceDrafts call with options'
      pattern: 'ingestWebsiteEvidenceDrafts.*jsHeavyHints'
    - from: 'lib/research-executor.ts'
      to: 'lib/enrichment/source-discovery.ts'
      via: 'initialSourceSet.urls providing jsHeavyHint values'
      pattern: "initialSourceSet\\.urls\\.map"
---

<objective>
Wire the jsHeavyHints map from the research executor's sourceSet into the modified `ingestWebsiteEvidenceDrafts` function, completing the Phase 28 -> Phase 29 data flow.

Purpose: Without this wiring, `ingestWebsiteEvidenceDrafts` would fall back to `detectJsHeavy()` for every URL, re-computing what Phase 28 already discovered. Passing the pre-computed hints ensures routing decisions use the exact same `jsHeavyHint` flags that were persisted in the sourceSet.

Output: Research executor passes jsHeavyHints; two-tier extraction is fully integrated.
</objective>

<execution_context>
@/home/klarifai/.claude/get-shit-done/workflows/execute-plan.md
@/home/klarifai/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/29-browser-rendered-evidence-extraction/29-RESEARCH.md
@.planning/phases/29-browser-rendered-evidence-extraction/29-01-SUMMARY.md

@lib/research-executor.ts
@lib/web-evidence-adapter.ts
@lib/enrichment/source-discovery.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Wire jsHeavyHints map from sourceSet into ingestWebsiteEvidenceDrafts</name>
  <files>lib/research-executor.ts</files>
  <action>
    In `lib/research-executor.ts`, find the section where `ingestWebsiteEvidenceDrafts(researchUrls)` is called (around line 264).

    **Before the call**, build the jsHeavyHints map from `initialSourceSet.urls`:
    ```typescript
    const jsHeavyHints = new Map<string, boolean>(
      initialSourceSet.urls.map((u) => [u.url, u.jsHeavyHint]),
    );
    ```

    **Update the call** to pass the options:
    ```typescript
    const websiteEvidenceDrafts = await ingestWebsiteEvidenceDrafts(researchUrls, {
      jsHeavyHints,
    });
    ```

    This is a 3-line change. Do NOT modify any other part of the research executor. The `initialSourceSet` variable is already available in scope (built earlier in the function via `buildSourceSet`).

    Do NOT touch the deepCrawl `ingestCrawl4aiEvidenceDrafts(serpUrls)` call â€” that path is separate and has its own cap (10 URLs). The EXTR-03 budget applies only to the website extraction path per Research open question 2.

  </action>
  <verify>
    <automated>npm run check</automated>
    <manual>Verify that the jsHeavyHints map is constructed from initialSourceSet.urls and passed to ingestWebsiteEvidenceDrafts. Confirm no other changes to research-executor.ts.</manual>
  </verify>
  <done>
    `ingestWebsiteEvidenceDrafts` receives jsHeavyHints from the sourceSet. TypeScript compiles cleanly. The existing deepCrawl Crawl4AI path is untouched.
  </done>
</task>

</tasks>

<verification>
```bash
npm run check
npx vitest run lib/web-evidence-adapter.test.ts --reporter=verbose
```
</verification>

<success_criteria>

- `npm run check` passes
- `research-executor.ts` constructs jsHeavyHints map from `initialSourceSet.urls`
- `ingestWebsiteEvidenceDrafts` is called with `{ jsHeavyHints }` options
- deepCrawl `ingestCrawl4aiEvidenceDrafts` call is untouched
- All existing web-evidence-adapter tests still pass
  </success_criteria>

<output>
After completion, create `.planning/phases/29-browser-rendered-evidence-extraction/29-02-SUMMARY.md`
</output>
