---
phase: 13-prospect-story-flow
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - app/admin/prospects/[id]/page.tsx
  - components/features/prospects/evidence-section.tsx
autonomous: true

must_haves:
  truths:
    - 'Prospect detail page shows vertical sections instead of horizontal tabs'
    - 'Evidence section lists all scraped sources with their source URLs visible'
    - 'Admin can see which type of source each evidence item came from'
    - 'Section navigation is visible so admin knows where they are in the story'
  artifacts:
    - path: 'app/admin/prospects/[id]/page.tsx'
      provides: 'Restructured prospect detail with vertical sections and section nav'
    - path: 'components/features/prospects/evidence-section.tsx'
      provides: 'Evidence section component displaying scraped sources with URLs'
  key_links:
    - from: 'app/admin/prospects/[id]/page.tsx'
      to: 'components/features/prospects/evidence-section.tsx'
      via: 'import EvidenceSection'
      pattern: 'import.*EvidenceSection'
    - from: 'components/features/prospects/evidence-section.tsx'
      to: 'api.research.listEvidence'
      via: 'tRPC query for evidence items'
      pattern: "research\\.listEvidence"
---

<objective>
Replace the 7-tab layout in the prospect detail page with a vertical section flow, and build the first section (Evidence) showing scraped sources with their URLs.

Purpose: Transform the prospect detail from a disconnected tab view into a linear story where the admin reads top-to-bottom: what was found (Evidence) -> what it means (Analysis) -> what goes out (Outreach Preview) -> what happened (Results).

Output: Restructured page.tsx with section anchors and sticky section nav, plus a new EvidenceSection component that displays all evidence items grouped by source type with clickable URLs.
</objective>

<execution_context>
@/home/klarifai/.claude/get-shit-done/workflows/execute-plan.md
@/home/klarifai/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@app/admin/prospects/[id]/page.tsx
@components/features/prospects/command-center.tsx
@server/routers/research.ts
@server/routers/admin.ts
@prisma/schema.prisma
</context>

<tasks>

<task type="auto">
  <name>Task 1: Restructure prospect detail page from tabs to vertical sections</name>
  <files>app/admin/prospects/[id]/page.tsx</files>
  <action>
    Replace the 7-tab layout with a vertical section flow. Keep the existing header (back button, status badge, company name, share button) and company info card and contacts section unchanged at the top.

    Remove the CommandCenter component — its functionality (pipeline status, actions, hypothesis quick-view) is being distributed into the four sections. Remove the entire `{/* Command Center */}` section block.

    Remove the tab bar (`const tabs = [...]` and the tab button row) and the tab content switching (`{activeTab === 'signals' && ...}` etc).

    Replace with four section containers in order:
    1. Evidence (id="evidence")
    2. Analysis (id="analysis")
    3. Outreach Preview (id="outreach-preview")
    4. Results (id="results")

    Add a sticky section nav below the contacts section — a horizontal bar with 4 buttons that scroll-to the corresponding section ID using `document.getElementById(id)?.scrollIntoView({ behavior: 'smooth' })`. Style it matching the existing tab bar aesthetic (bg-slate-50/80, rounded-2xl, border border-slate-100) but keep it sticky with `sticky top-0 z-10 bg-white/90 backdrop-blur-sm`.

    For now, sections 2-4 should render placeholder cards with the section name:
    ```tsx
    <section id="analysis" className="scroll-mt-16">
      <h2 className="text-[10px] font-black text-slate-300 uppercase tracking-[0.2em] mb-4">Analysis</h2>
      <div className="glass-card p-8 text-center">
        <p className="text-sm text-slate-400">Analysis section — coming in plan 13-02</p>
      </div>
    </section>
    ```

    Section 1 (Evidence) imports and renders `<EvidenceSection prospectId={id} />`.

    Keep all existing tRPC queries that are still needed (researchRuns, hypothesisData, latestLossMap, latestCallPrep, mutations). Only remove queries/mutations that were exclusively used by the CommandCenter or tabs that no longer exist inline. Keep the signals, research, and hypothesis mutations — they'll be needed by their respective sections.

    Actually — to keep this plan focused, only keep the evidence-related queries in this page for now. The other sections will add their own queries when they're built in plans 02-04. Keep ALL existing mutations (startResearch, matchProof, setHypothesisStatus, generateLossMap, queueLossMapDraft, generateCallPrep) because they'll be passed to section components later. Remove only the old tab-specific sub-components at the bottom of the file (SignalsTab, ResearchTab, HypothesesTab, LossMapTab, CallPrepTab) — their content moves into section components.

    Remove the `type Tab` union type. Remove `activeTab` state. Keep `manualResearchUrls` state (needed by research actions). Keep `contactDiscoveryGuardrail` state.

    Also remove the import of `CommandCenter` and `CadenceTab`.

    Important: Keep the page under 300 lines. The heavy lifting moves to section component files.

  </action>
  <verify>
    Run `npx tsc --noEmit` — no type errors in page.tsx.
    The page should render with header, company info, contacts, sticky section nav, and four section areas (Evidence populated, others placeholder).
  </verify>
  <done>
    Prospect detail page shows a vertical flow with section nav instead of horizontal tabs. Evidence section is rendered. Other sections show placeholders. No tab switching UI remains.
  </done>
</task>

<task type="auto">
  <name>Task 2: Build Evidence section component with source URL display</name>
  <files>components/features/prospects/evidence-section.tsx</files>
  <action>
    Create `components/features/prospects/evidence-section.tsx` as a client component.

    Props: `{ prospectId: string }`

    Use `api.research.listEvidence.useQuery({ prospectId })` to fetch all evidence items for this prospect. Also use `api.signals.fetchForCompany` mutation and read signals from `api.admin.getProspect` query (or pass signals as a prop — use the simpler approach).

    Actually, to keep things clean: the component receives `prospectId` and fetches its own data using `api.research.listEvidence.useQuery({ prospectId })`. For signals, add a separate call or accept them as a prop. Use a prop approach: `{ prospectId: string; signals?: any[] }`.

    Display evidence items grouped by sourceType (WEBSITE, DOCS, CAREERS, HELP_CENTER, JOB_BOARD, REVIEWS, MANUAL_URL). Use plain-language group labels:
    - WEBSITE -> "Website Pages"
    - DOCS -> "Documentation"
    - CAREERS -> "Career Pages"
    - HELP_CENTER -> "Help Center"
    - JOB_BOARD -> "Job Listings"
    - REVIEWS -> "Reviews"
    - MANUAL_URL -> "Manually Added"

    For each evidence item, show:
    - The title (or truncated sourceUrl if no title)
    - The sourceUrl as a clickable external link (truncated to ~60 chars with full URL on hover via title attribute)
    - The snippet (first 200 chars, line-clamped to 2 lines)
    - A confidence indicator (confidenceScore as a small colored dot: >=0.7 emerald, >=0.4 amber, <0.4 slate)
    - The workflowTag displayed as a small pill/badge, but use a plain-language label mapping:
      - Map common workflow tags to readable labels. If a tag doesn't match any mapping, display it as-is but sentence-cased.

    If signals are provided, show them in a separate group at the top labeled "Buying Signals" with the existing signal rendering style (signal type, title, date).

    Show total count in the section header: "Evidence (N sources)"

    Style: glass-card for the overall container. Each evidence item is a compact row. Groups are separated by section dividers. Use the established design patterns (text-[10px] font-black uppercase tracking-[0.2em] for group headers).

    Handle empty state: "No evidence collected yet. Run research to gather sources." with a subtle icon.

    Keep the component under 200 lines.

  </action>
  <verify>
    Run `npx tsc --noEmit` — no type errors.
    Run `npm run check` — passes lint and format.
  </verify>
  <done>
    Evidence section component exists, fetches evidence items via tRPC, groups them by source type with plain-language labels, and shows clickable source URLs for each item. Admin can see exactly where data came from.
  </done>
</task>

</tasks>

<verification>
1. `npm run check` passes (type-check + lint + format)
2. Prospect detail page loads with vertical section layout (not tabs)
3. Evidence section displays scraped sources grouped by type with visible URLs
4. Sticky section nav allows jumping between sections
5. No "Loss Map", "Call Prep", or other jargon in the Evidence section
</verification>

<success_criteria>

- Prospect detail page uses vertical sections, not tabs
- Evidence section shows source URLs that admin can click to verify data sources
- Section navigation is sticky and scrolls to correct section
- Page.tsx is under 300 lines (heavy logic extracted to section components)
- TypeScript compiles without errors
  </success_criteria>

<output>
After completion, create `.planning/phases/13-prospect-story-flow/13-01-SUMMARY.md`
</output>
