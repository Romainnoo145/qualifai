---
phase: 13-prospect-story-flow
plan: 03
type: execute
wave: 2
depends_on: ['13-01']
files_modified:
  - components/features/prospects/outreach-preview-section.tsx
  - app/admin/prospects/[id]/page.tsx
autonomous: true

must_haves:
  truths:
    - 'Admin sees the exact email content that will be sent to the prospect'
    - 'Admin sees a link to the prospect dashboard (/voor/) showing what the prospect will see'
    - 'Admin sees the call brief (30/60/90 plan) as part of the outreach preview'
    - 'Admin can generate reports and queue outreach drafts from this section'
  artifacts:
    - path: 'components/features/prospects/outreach-preview-section.tsx'
      provides: 'Outreach Preview section showing email content, dashboard link, and call brief'
  key_links:
    - from: 'app/admin/prospects/[id]/page.tsx'
      to: 'components/features/prospects/outreach-preview-section.tsx'
      via: 'import OutreachPreviewSection'
      pattern: 'import.*OutreachPreviewSection'
    - from: 'components/features/prospects/outreach-preview-section.tsx'
      to: 'api.assets.getLatest'
      via: 'tRPC query for latest workflow report'
      pattern: "assets\\.getLatest"
---

<objective>
Build the Outreach Preview section that shows admin exactly what the prospect will receive — the email sequence, the dashboard content, and the call brief — before anything is sent.

Purpose: Admin needs a single view of "what goes out the door" — no more switching between Workflow Report, Call Brief, and Wizard tabs to piece together the outreach story.

Output: OutreachPreviewSection component that combines email preview, dashboard link, and call brief into one cohesive preview.
</objective>

<execution_context>
@/home/klarifai/.claude/get-shit-done/workflows/execute-plan.md
@/home/klarifai/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/13-prospect-story-flow/13-01-SUMMARY.md
@server/routers/assets.ts
@server/routers/call-prep.ts
@server/routers/sequences.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Outreach Preview section component</name>
  <files>components/features/prospects/outreach-preview-section.tsx</files>
  <action>
    Create `components/features/prospects/outreach-preview-section.tsx` as a client component.

    Props:
    ```tsx
    {
      prospectId: string;
      prospect: any; // prospect data with slug, readableSlug, companyName, contacts
      latestRunId: string | null;
      onGenerateReport: () => void;
      onGenerateCallBrief: () => void;
      onQueueOutreach: (contactId: string) => void;
      isGeneratingReport: boolean;
      isGeneratingCallBrief: boolean;
      isQueueing: boolean;
    }
    ```

    Use these tRPC queries inside the component:
    - `api.assets.getLatest.useQuery({ prospectId })` — for the workflow report (email content)
    - `api.callPrep.getLatest.useQuery({ prospectId })` — for the call brief
    - `api.sequences.list.useQuery({ prospectId })` — for outreach sequence steps (if any exist)

    Layout the section in three sub-sections:

    **1. Email Preview**
    If a workflow report exists (`latestLossMap`):
    - Show the email subject line prominently
    - Show email body text in a preview container styled like an email (white bg, border, slight shadow, monospace-ish feel)
    - Show CTA Step 1 and CTA Step 2 as highlighted callouts
    - "Generate Report" button and "Queue Outreach Draft" button (pass first contact's ID)
    - PDF download link
    If no report: "No outreach email generated yet" with "Generate Report" button (disabled if no latestRunId)

    **2. Dashboard Preview**
    Show a link card to the prospect's dashboard:
    - If prospect has readableSlug: link to `/voor/{readableSlug}` with "Preview Dashboard" button
    - If no readableSlug but has slug: link to `/discover/{slug}` with "Preview Wizard" button
    - Include a small description: "This is what the prospect sees when they click the link in the email"

    **3. Call Brief**
    If a call prep plan exists:
    - Show the summary
    - Show the 30/60/90 plan in a compact 3-column grid (matching existing CallPrepTab layout but more compact)
    - "Regenerate" button
    If no plan: "No call brief generated yet" with "Generate 30/60/90 Plan" button (disabled if no latestRunId)

    If outreach sequences exist, show a small status indicator at the top: "Outreach sequence: [status] — [N] steps"

    Section header: "Outreach Preview"

    Handle loading state with skeleton loaders.

    Plain-language labels throughout — no "Loss Map", "Workflow Report" internal jargon. Use:
    - "Email Content" for the email section
    - "Prospect Dashboard" for the dashboard section
    - "Call Brief" for the call brief section

    Keep under 250 lines.

  </action>
  <verify>
    Run `npx tsc --noEmit` — no type errors.
  </verify>
  <done>
    Outreach Preview section shows email content, dashboard link, and call brief in one unified view. Admin can see exactly what the prospect will receive.
  </done>
</task>

<task type="auto">
  <name>Task 2: Wire Outreach Preview section into prospect detail page</name>
  <files>app/admin/prospects/[id]/page.tsx</files>
  <action>
    Import OutreachPreviewSection from `@/components/features/prospects/outreach-preview-section`.

    Replace the Outreach Preview section placeholder with:
    ```tsx
    <OutreachPreviewSection
      prospectId={id}
      prospect={p}
      latestRunId={latestRunId}
      onGenerateReport={runLossMapGeneration}
      onGenerateCallBrief={runCallPrepGeneration}
      onQueueOutreach={queueOutreachForContact}
      isGeneratingReport={generateLossMap.isPending}
      isGeneratingCallBrief={generateCallPrep.isPending}
      isQueueing={queueLossMapDraft.isPending}
    />
    ```

    Ensure `latestRunId` is computed from `researchRuns.data` (the query should still exist — verify from 13-01 SUMMARY). The `runLossMapGeneration`, `runCallPrepGeneration`, and `queueOutreachForContact` functions should still exist from the page restructure.

    Verify the page still compiles and all imports are correct.

  </action>
  <verify>
    Run `npm run check` — passes type-check + lint + format.
  </verify>
  <done>
    Outreach Preview section is wired into the page, showing email content, dashboard link, and call brief. The old LossMapTab, CallPrepTab, and Wizard tab content is fully replaced.
  </done>
</task>

</tasks>

<verification>
1. `npm run check` passes
2. Outreach Preview section shows email subject and body when a report exists
3. Dashboard preview link points to correct URL (/voor/ or /discover/)
4. Call brief shows 30/60/90 plan when generated
5. Generate and Queue buttons work
6. No jargon in section labels
</verification>

<success_criteria>

- Admin sees exactly what the prospect will receive in one section (email, dashboard, call brief)
- Dashboard link is correct and clickable
- Email content is readable in a preview format
- Action buttons (generate, queue, regenerate) all function
- TypeScript compiles without errors
  </success_criteria>

<output>
After completion, create `.planning/phases/13-prospect-story-flow/13-03-SUMMARY.md`
</output>
