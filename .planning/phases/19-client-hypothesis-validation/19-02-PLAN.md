---
phase: 19-client-hypothesis-validation
plan: '02'
type: execute
wave: 2
depends_on: ['19-01']
files_modified:
  - app/voor/[slug]/page.tsx
  - app/voor/[slug]/dashboard-client.tsx
autonomous: true

must_haves:
  truths:
    - 'After the first outreach email is sent, the /voor/ dashboard Step 1 shows a validation section where the prospect can confirm or decline each hypothesis'
    - 'A confirmed hypothesis shows a green confirmed state with checkmark; a declined hypothesis shows a dimmed acknowledged state'
    - 'Clicking confirm or decline gives immediate visual feedback (optimistic update) without waiting for server response'
    - 'The validation card shows the pain-point hypothesis title and problem statement, not email text'
    - 'Validation section only appears for prospects with status SENT or beyond (not READY)'
    - 'Declined hypotheses on page refresh are excluded from the fetch (existing filter already does this)'
  artifacts:
    - path: 'app/voor/[slug]/page.tsx'
      provides: 'Hypothesis status field + prospectStatus prop passed to DashboardClient'
      contains: 'status: true'
    - path: 'app/voor/[slug]/dashboard-client.tsx'
      provides: 'Validation card UI in Step 1 with confirm/decline buttons and optimistic state'
      contains: 'validateByProspect'
  key_links:
    - from: 'app/voor/[slug]/page.tsx'
      to: 'app/voor/[slug]/dashboard-client.tsx'
      via: 'prospectStatus prop and hypothesis status field'
      pattern: 'prospectStatus='
    - from: 'app/voor/[slug]/dashboard-client.tsx'
      to: 'server/routers/hypotheses.ts'
      via: 'tRPC mutation call'
      pattern: "api\\.hypotheses\\.validateByProspect"
---

<objective>
Add the hypothesis validation card UI to Step 1 ("Pijnpunten") of the /voor/ prospect dashboard. Prospects can confirm ("Ja, herkenbaar") or decline ("Nee, niet van toepassing") each hypothesis with a single click. Visual feedback is optimistic. The section only appears after the first outreach email is sent (prospect status SENT+).

Purpose: Shift hypothesis validation from admin guesswork to direct prospect confirmation, completing the core Phase 19 user story.
Output: Working validation UI on /voor/ dashboard with confirm/decline buttons and optimistic state management.
</objective>

<execution_context>
@/home/klarifai/.claude/get-shit-done/workflows/execute-plan.md
@/home/klarifai/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/19-client-hypothesis-validation/19-RESEARCH.md
@.planning/phases/19-client-hypothesis-validation/19-01-SUMMARY.md

# Key source files

@app/voor/[slug]/page.tsx
@app/voor/[slug]/dashboard-client.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Pass hypothesis status + prospect status to DashboardClient</name>
  <files>app/voor/[slug]/page.tsx, app/voor/[slug]/dashboard-client.tsx</files>
  <action>
**app/voor/[slug]/page.tsx:**

1. Add `status: true` to the `workflowHypotheses` select block (after `revenueLeakageRecoveredMid: true`). This passes each hypothesis's status to the client.
2. Add `prospectStatus={prospect.status}` prop to the `<DashboardClient>` invocation (after the `hypotheses` prop).

No changes to the `where` filter — keep `{ status: { in: ['ACCEPTED', 'PENDING'] } }` as-is. DECLINED hypotheses are intentionally excluded from the server fetch (they don't reappear on revisit).

**app/voor/[slug]/dashboard-client.tsx:**

1. Add `status: 'ACCEPTED' | 'PENDING' | 'DECLINED'` to the `HypothesisData` interface (after `proofMatches`).
2. Add `prospectStatus: string` to the `DashboardClientProps` interface (after `hypotheses`).
3. Add `prospectStatus` to the destructured props in the component function.

This is pure data plumbing — no UI changes yet.
</action>
<verify>Run `npx tsc --noEmit` — zero type errors. Grep for `prospectStatus` in both files to confirm the prop chain is wired.</verify>
<done>Hypothesis `status` field flows from Prisma select through page.tsx to DashboardClient. `prospectStatus` prop flows from `prospect.status` through page.tsx to DashboardClient. No UI changes yet — pure data plumbing.</done>
</task>

<task type="auto">
  <name>Task 2: Add validation card UI to Step 1 with optimistic confirm/decline</name>
  <files>app/voor/[slug]/dashboard-client.tsx</files>
  <action>
Add hypothesis validation UI to Step 1 ("Pijnpunten") of `dashboard-client.tsx`. This is the core Phase 19 feature.

**1. State and mutation setup (inside the component, after existing state declarations):**

```typescript
// Hypothesis validation state — optimistic updates
const [validationState, setValidationState] = useState<
  Record<string, 'confirmed' | 'declined' | null>
>({});

// Pre-populate from server-provided status
useEffect(() => {
  const initial: Record<string, 'confirmed' | 'declined' | null> = {};
  for (const h of hypotheses) {
    if (h.status === 'ACCEPTED') initial[h.id] = 'confirmed';
    if (h.status === 'DECLINED') initial[h.id] = 'declined';
    // PENDING = null (not yet validated by prospect)
  }
  setValidationState(initial);
}, [hypotheses]);

const validateHypothesis = api.hypotheses.validateByProspect.useMutation();

const handleValidate = (
  hypothesisId: string,
  action: 'confirm' | 'decline',
) => {
  // Optimistic update BEFORE server call (prevents double-click, gives instant feedback)
  setValidationState((prev) => ({
    ...prev,
    [hypothesisId]: action === 'confirm' ? 'confirmed' : 'declined',
  }));
  validateHypothesis.mutate({ slug: prospectSlug, hypothesisId, action });
};
```

**2. Visibility gate — determine if validation section should show:**

```typescript
// Show validation section only after first outreach email is sent
const showValidation = ['SENT', 'VIEWED', 'ENGAGED', 'CONVERTED'].includes(
  prospectStatus,
);
```

Place this in the derived data section (after `const totalHoursSaved = ...`).

**3. Validation section UI in Step 1:**

After the existing hypothesis card grid (inside `{currentStep === 1 && (` block), after the closing `</div>` of the `grid grid-cols-1 md:grid-cols-2 gap-4` div but still inside the `{hypotheses.length > 0 ? (` branch, add the validation section:

```tsx
{
  /* Hypothesis validation section — only for SENT+ prospects */
}
{
  showValidation && (
    <div className="mt-8 space-y-4">
      <div className="text-center">
        <p className="text-sm font-bold text-slate-700">
          Herkent u deze pijnpunten?
        </p>
        <p className="text-xs text-slate-400 mt-1">
          Laat ons weten welke punten bij uw situatie passen
        </p>
      </div>

      <div className="space-y-3">
        {hypotheses.map((hypothesis) => {
          const state = validationState[hypothesis.id];
          return (
            <motion.div
              key={`validate-${hypothesis.id}`}
              layout
              className={`glass-card p-4 transition-all ${
                state === 'confirmed'
                  ? 'border-emerald-200 bg-emerald-50/50'
                  : state === 'declined'
                    ? 'opacity-50 bg-slate-50'
                    : ''
              }`}
            >
              <div className="flex items-start justify-between gap-4">
                <div className="flex-1 min-w-0">
                  <h4 className="text-sm font-semibold text-slate-900">
                    {hypothesis.title}
                  </h4>
                  <p className="text-xs text-slate-500 mt-1">
                    {hypothesis.problemStatement}
                  </p>
                </div>

                <div className="flex items-center gap-2 shrink-0">
                  {state === 'confirmed' ? (
                    <span className="flex items-center gap-1.5 text-xs font-semibold text-emerald-700 px-3 py-1.5 rounded-lg bg-emerald-100">
                      <CheckCircle2 className="w-3.5 h-3.5" />
                      Bevestigd
                    </span>
                  ) : state === 'declined' ? (
                    <span className="flex items-center gap-1.5 text-xs font-medium text-slate-400 px-3 py-1.5 rounded-lg bg-slate-100">
                      Niet van toepassing
                    </span>
                  ) : (
                    <>
                      <button
                        onClick={() => handleValidate(hypothesis.id, 'confirm')}
                        className="flex items-center gap-1.5 text-xs font-semibold px-3 py-1.5 rounded-lg bg-emerald-50 text-emerald-700 hover:bg-emerald-100 border border-emerald-200 transition-all"
                      >
                        <CheckCircle2 className="w-3.5 h-3.5" />
                        Ja, herkenbaar
                      </button>
                      <button
                        onClick={() => handleValidate(hypothesis.id, 'decline')}
                        className="flex items-center gap-1.5 text-xs font-medium px-3 py-1.5 rounded-lg bg-slate-50 text-slate-500 hover:bg-slate-100 border border-slate-200 transition-all"
                      >
                        Nee
                      </button>
                    </>
                  )}
                </div>
              </div>
            </motion.div>
          );
        })}
      </div>
    </div>
  );
}
```

**Design notes:**

- Dutch (NL) labels per user preference: "Ja, herkenbaar" (confirm), "Nee" (decline), "Bevestigd" (confirmed), "Niet van toepassing" (declined)
- Compact layout (p-4) per user preference for compact UI
- Green border/bg for confirmed; dimmed opacity-50 + slate for declined
- `CheckCircle2` already imported at top of file — no new imports needed
- `motion.div` with `layout` for smooth transitions when state changes
- Buttons disabled after click via state check (state !== null removes buttons)
- No blocking navigation — validation section is optional, prospect can always proceed to Steps 2/3

**4. Import `XCircle` if not already imported — actually check: `XCircle` is NOT in the current imports. Since we are using text-only for decline ("Nee"), no new icon import is needed. `CheckCircle2` is already imported.**

**IMPORTANT:** Do NOT modify any existing hypothesis card rendering in Step 1. The validation section is a SEPARATE block below the existing hypothesis grid. The existing cards show the pain-point details; the validation section below lets the prospect respond.
</action>
<verify>Run `npx tsc --noEmit` — zero type errors. Visit `/voor/[any-slug]` and navigate to Step 1 — if prospect status is SENT+, a "Herkent u deze pijnpunten?" section should appear below the hypothesis cards with confirm/decline buttons per hypothesis.</verify>
<done>Step 1 of /voor/ dashboard shows a validation section for SENT+ prospects. Each hypothesis has "Ja, herkenbaar" and "Nee" buttons. Clicking confirm shows green "Bevestigd" chip; clicking decline shows dimmed "Niet van toepassing". State is optimistic — instant visual feedback. The mutation fires in the background. Admin sees ACCEPTED/DECLINED on next page load in Analysis section.</done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes with zero errors
2. `page.tsx` includes `status: true` in workflowHypotheses select
3. `page.tsx` passes `prospectStatus={prospect.status}` to DashboardClient
4. `dashboard-client.tsx` has `status` in HypothesisData and `prospectStatus` in DashboardClientProps
5. `dashboard-client.tsx` contains `api.hypotheses.validateByProspect.useMutation()`
6. `dashboard-client.tsx` contains `showValidation` guard checking for SENT+
7. The validation UI renders only inside Step 1, below the existing hypothesis grid
</verification>

<success_criteria>

- SENT+ prospect visiting /voor/ sees confirm/decline buttons per hypothesis on Step 1
- READY prospect does NOT see validation buttons (visibility gate)
- Clicking confirm shows green "Bevestigd" state immediately (optimistic)
- Clicking decline shows dimmed "Niet van toepassing" state immediately (optimistic)
- Already-confirmed/declined hypotheses show their state without buttons (pre-populated from server status)
- Admin opens prospect detail → Analysis section shows "Confirmed by prospect" for confirmed hypotheses, "Declined by prospect" for declined — no admin action required
- TypeScript compiles clean
  </success_criteria>

<output>
After completion, create `.planning/phases/19-client-hypothesis-validation/19-02-SUMMARY.md`
</output>
